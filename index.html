<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מערכת תקציב גיא שומרי - HTML</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- SheetJS for Excel file processing - Simple and reliable approach -->
    <script>
        // XLSX Dynamic Loader with multiple fallbacks
        window.XLSX_LOAD_FAILED = false;
        
        function loadXLSXLibrary() {
            return new Promise((resolve, reject) => {
                // Try multiple CDN sources
                const cdnSources = [
                    'https://unpkg.com/xlsx@0.18.5/dist/xlsx.full.min.js',
                    'https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js',
                    'https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js'
                ];

                let sourceIndex = 0;

                const tryNext = () => {
                    if (sourceIndex >= cdnSources.length) {
                        window.XLSX_LOAD_FAILED = true;
                        reject(new Error('כל מקורות XLSX נכשלו'));
                        return;
                    }

                    console.log(`נסיון ${sourceIndex + 1}: טוען XLSX מ-${cdnSources[sourceIndex]}`);
                    const script = document.createElement('script');
                    script.src = cdnSources[sourceIndex];
                    
                    script.onload = () => {
                        console.log(`✅ XLSX נטען בהצלחה מ-${cdnSources[sourceIndex]}`);
                        resolve();
                    };
                    
                    script.onerror = () => {
                        console.warn(`❌ נכשל: ${cdnSources[sourceIndex]}`);
                        sourceIndex++;
                        tryNext();
                    };

                    document.head.appendChild(script);
                };

                tryNext();
            });
        }

        // Try to load immediately
        loadXLSXLibrary().catch(() => {
            console.error('❌ לא הצלחנו לטעון את ספריית XLSX');
        });

        // Check again after page loads
        window.addEventListener('load', function() {
            setTimeout(function() {
                if (typeof XLSX === 'undefined' && !window.XLSX_LOAD_FAILED) {
                    console.log('🔄 נסיון נוסף לטעון XLSX...');
                    loadXLSXLibrary();
                }
            }, 500);
        });
    </script>
</head>
<body>
    <!-- User Setup Modal -->
    <div id="userSetupModal" class="modal-overlay" style="display: none;">
        <div class="modal-content" style="max-width: 500px; padding: 30px;">
            <h2 style="text-align: center; color: #1f4e79; margin-bottom: 5px;">👤 ברוך הבא למערכת תקציב</h2>
            <h3 style="text-align: center; color: #1f4e79; margin-top: 0; margin-bottom: 10px; font-weight: 500;">של גיא שומרי</h3>
            <p style="text-align: center; color: #666; margin-bottom: 25px;">אנא הזן את פרטייך לפני תחילת השימוש</p>
            <form id="userSetupForm">
                <div style="margin-bottom: 20px;">
                    <label for="userName" style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">שם מלא:</label>
                    <input type="text" id="userName" required style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; font-family: 'Heebo', sans-serif;" placeholder="הזן שם מלא">
                </div>
                <div style="margin-bottom: 20px;">
                    <label for="userPhone" style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">מספר נייד (אופציונלי):</label>
                    <input type="tel" id="userPhone" pattern="[0-9]{10}" maxlength="10" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; font-family: 'Heebo', sans-serif;" placeholder="05XXXXXXXX">
                    <small style="color: #666; display: block; margin-top: 5px;">10 ספרות בלבד (אופציונלי)</small>
                </div>
                <div style="margin-bottom: 25px;">
                    <label for="userId" style="display: block; font-weight: 600; margin-bottom: 8px; color: #333;">תעודת זהות (אופציונלי):</label>
                    <input type="text" id="userId" pattern="[0-9]{9}" maxlength="9" style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 16px; font-family: 'Heebo', sans-serif;" placeholder="123456789">
                    <small style="color: #666; display: block; margin-top: 5px;">9 ספרות בלבד (אופציונלי)</small>
                </div>
                <button type="submit" style="width: 100%; padding: 15px; background: #1f4e79; color: white; border: none; border-radius: 8px; font-size: 18px; font-weight: 600; cursor: pointer; font-family: 'Heebo', sans-serif;">✅ התחל שימוש במערכת</button>
            </form>
        </div>
    </div>

    <div class="container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="title-wrapper">
                    <div class="title-icon">🎯</div>
                    <h1 class="title">מערכת תקציב<br><span class="title-highlight">גיא שומרי</span></h1>
                </div>
                <p class="subtitle">מערכת ניהול תקציב חכמה ופשוטה</p>
                <div class="year-selector-header">
                    <label for="yearSelect">שנה נבחרת:</label>
                    <select id="yearSelect" class="year-select">
                        <!-- Years will be populated dynamically -->
                    </select>
                </div>
            </div>
        </header>

        <!-- Navigation Tabs -->
        <nav class="nav-tabs">
            <button class="tab-btn active" data-tab="data-entry">📊 הזנת נתונים</button>
            <button class="tab-btn" data-tab="monthly">📅 תצוגה חודשית</button>
            <button class="tab-btn" data-tab="dashboard">📈 סיכום</button>
            <button class="tab-btn" data-tab="settings">⚙️ הגדרות</button>
        </nav>

        <!-- Tab Content -->
        <main class="tab-content">
            <!-- Data Entry Tab -->
            <div id="data-entry" class="tab-panel active">
                <div class="panel-header">
                    <h2>📊 הזנת עסקאות</h2>
                    <div class="header-controls">
                        <div class="month-selector-inline">
                            <label for="dataEntryMonthSelect">חודש:</label>
                            <select id="dataEntryMonthSelect" class="month-select-inline">
                                <option value="all">כל החודשים</option>
                                <option value="01">ינואר</option>
                                <option value="02">פברואר</option>
                                <option value="03">מרץ</option>
                                <option value="04">אפריל</option>
                                <option value="05">מאי</option>
                                <option value="06">יוני</option>
                                <option value="07">יולי</option>
                                <option value="08">אוגוסט</option>
                                <option value="09">ספטמבר</option>
                                <option value="10">אוקטובר</option>
                                <option value="11">נובמבר</option>
                                <option value="12">דצמבר</option>
                            </select>
                        </div>
                        <div style="display: flex; gap: 10px;">
                            <button id="addTransactionBtn" class="btn btn-primary">+ הוסף עסקה</button>
                            <button id="importCsvBtn" class="btn btn-secondary" title="ניתן לטעון קובץ Excel (.xlsx) או CSV">📄 ייבוא דף חשבון</button>
                            <input type="file" id="importCsvFile" accept=".csv,.xlsx" style="display: none;">
                        </div>
                    </div>
                </div>

                <!-- Add Transaction Form -->
                <div id="transactionForm" class="form-card">
                    <h3>עסקה חדשה</h3>
                    <form id="newTransactionForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="item">פריט</label>
                                <input type="text" id="item" placeholder="התחל לכתוב ..." required autocomplete="off">
                                <small style="color: #666; margin-top: 5px;">
                                    התחל להקליד - יופיעו הצעות מהמיפויים הקיימים. פריטים חדשים ידרשו אישור.
                                </small>
                            </div>
                            <div class="form-group">
                                <label for="amount">סכום</label>
                                <input type="number" id="amount" step="0.01" placeholder="סכום בשקלים" required>
                            </div>
                            <div class="form-group">
                                <label for="note">הערה</label>
                                <input type="text" id="note" placeholder="הערה (אופציונלי)">
                            </div>
                            <div class="form-group">
                                <label for="transactionColor">צבע</label>
                                <select id="transactionColor" class="color-select">
                                    <option value="none">ללא צבע</option>
                                    <option value="yellow">🟡 צהוב</option>
                                    <option value="green">🟢 ירוק</option>
                                    <option value="blue">🔵 כחול</option>
                                    <option value="pink">🩷 ורוד</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>סוג</label>
                                <div style="display: flex; gap: 20px; margin-top: 8px;">
                                    <label class="radio-label" style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="radio" name="transactionType" value="expense" id="typeExpense" checked style="margin-left: 5px; cursor: pointer;">
                                        <span>הוצאה</span>
                                    </label>
                                    <label class="radio-label" style="display: flex; align-items: center; cursor: pointer;">
                                        <input type="radio" name="transactionType" value="income" id="typeIncome" style="margin-left: 5px; cursor: pointer;">
                                        <span>הכנסה</span>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="payment-method-section">
                                    <label class="checkbox-container">
                                        <input type="checkbox" id="isCheck" class="payment-check">
                                        <span class="checkmark"></span>
                                        <span class="checkbox-label">תשלום בצ'יק</span>
                                    </label>
                                </div>
                            </div>
                            <div class="form-group">
                                <div class="payment-method-section">
                                    <label class="checkbox-container">
                                        <input type="checkbox" id="isSpecialCheckItem" class="payment-check">
                                        <span class="checkmark"></span>
                                        <span class="checkbox-label" style="color: #6a1b9a; font-weight: 600;">💜 פריט שיק מיוחד (שיק)</span>
                                    </label>
                                    <small style="color: #6a1b9a; margin-top: 5px; display: block;">
                                        פריט יוצא דופן שלא ייכלל בחישובי הכנסה/הוצאה
                                    </small>
                                </div>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">💾 שמור</button>
                            <button type="button" id="cancelForm" class="btn btn-secondary">❌ בטל</button>
                        </div>
                    </form>
                </div>

                <!-- Transactions Table -->
                <div class="table-container">
                    <!-- Color Summary -->
                    <div id="colorSummary" style="margin-bottom: 15px; padding: 15px; background: #f5f5f5; border-radius: 8px; display: none;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="margin: 0; color: #1f4e79;">סיכום לפי צבעים:</h4>
                            <div style="display: flex; gap: 15px; align-items: center;">
                                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 0.9rem;">
                                    <input type="checkbox" id="colorCheckYellow" class="color-check" value="yellow" style="cursor: pointer;">
                                    <span>🟨 צהוב</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 0.9rem;">
                                    <input type="checkbox" id="colorCheckGreen" class="color-check" value="green" style="cursor: pointer;">
                                    <span>🟩 ירוק</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 0.9rem;">
                                    <input type="checkbox" id="colorCheckBlue" class="color-check" value="blue" style="cursor: pointer;">
                                    <span>🟦 כחול</span>
                                </label>
                                <label style="display: flex; align-items: center; gap: 5px; cursor: pointer; font-size: 0.9rem;">
                                    <input type="checkbox" id="colorCheckPink" class="color-check" value="pink" style="cursor: pointer;">
                                    <span>🟪 ורוד</span>
                                </label>
                            </div>
                        </div>
                        <div id="colorSummaryContent" style="display: flex; gap: 20px; flex-wrap: wrap;"></div>
                    </div>
                    
                    <table id="transactionsTable" class="data-table">
                        <thead>
                            <tr>
                                <th>חודש</th>
                                <th>פריט</th>
                                <th>סכום</th>
                                <th>סוג</th>
                                <th>קטגוריה</th>
                                <th>הערה</th>
                                <th>צ'יק</th>
                                <th style="width: 80px;">צבע</th>
                                <th>פעולות</th>
                            </tr>
                        </thead>
                        <tbody id="transactionsBody">
                            <!-- Transactions will be populated here -->
                        </tbody>
                    </table>
                </div>

                <!-- Check Items from Import Summary -->
                <div id="importedCheckItemsSummary" class="summary-card" style="display: none; margin-top: 20px;">
                    <h3>🏦 פריטי שיק מיובאים</h3>
                    <div id="importedCheckItemsList" class="check-payments-list">
                        <!-- Imported check items will be populated here -->
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settings" class="tab-panel">
                <div class="panel-header">
                    <h2>⚙️ הגדרות מערכת</h2>
                </div>

                <!-- User Details Section -->
                <div class="settings-section">
                    <h3 style="color: #1f4e79; margin-bottom: 15px;">👤 פרטי מפיק הדוח</h3>
                    <div class="form-grid" style="margin-bottom: 15px;">
                        <div class="form-group">
                            <label for="reportProducerName">שם מלא</label>
                            <input type="text" id="reportProducerName" placeholder="הזן שם מלא">
                        </div>
                        <div class="form-group">
                            <label for="reportProducerPhone">מספר טלפון (אופציונלי)</label>
                            <input type="tel" id="reportProducerPhone" placeholder="הזן מספר טלפון" pattern="[0-9]{10}" maxlength="10">
                        </div>
                        <div class="form-group">
                            <label for="reportProducerId">תעודת זהות (אופציונלי)</label>
                            <input type="text" id="reportProducerId" placeholder="הזן ת.ז" pattern="[0-9]{9}" maxlength="9">
                        </div>
                    </div>
                    <button id="updateProducerBtn" class="btn btn-primary">💾 שמור שינויים</button>
                </div>

                <!-- Settings Actions -->
                <div class="settings-section">
                    <h3 style="color: #1f4e79; margin-bottom: 15px;">📦 ייבוא וייצוא נתונים</h3>
                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 30px;">
                        <button id="exportMappingsBtn" class="btn btn-secondary">📋 ייצוא מיפויים</button>
                        <button id="exportBtn" class="btn btn-secondary">📥 ייצוא נתונים</button>
                        <button id="importBtn" class="btn btn-secondary">📤 ייבוא נתונים</button>
                        <input type="file" id="importFile" accept=".json" style="display: none;">
                    </div>
                </div>

                <!-- Dropbox Sync Section -->
                <div class="settings-section">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; gap: 10px;">
                        <h3 style="color: #1f4e79; margin: 0;">☁️ סנכרון Dropbox</h3>
                        <div style="display: flex; gap: 8px;">
                            <button onclick="window.dropboxSync?.showWhatIsSavedModal()" class="btn btn-success" style="font-size: 0.9em; padding: 5px 12px;">📦 מה נשמר?</button>
                            <button onclick="window.dropboxSync?.showHelpModal()" class="btn btn-info" style="font-size: 0.9em; padding: 5px 12px;">📖 איך להתחיל?</button>
                        </div>
                    </div>
                    
                    <div id="dropboxSyncStatus" style="background: #f8f9fa; padding: 10px; border-radius: 6px; margin-bottom: 15px; text-align: center; font-size: 0.95em;">
                        <span style="color: #6c757d;">⏳ טוען...</span>
                    </div>

                    <div class="form-grid" style="margin-bottom: 15px;">
                        <div class="form-group" style="grid-column: 1 / -1;">
                            <label for="dropboxAccessToken">Dropbox Access Token</label>
                            <input type="password" id="dropboxAccessToken" placeholder="הזן את ה-Access Token שלך" style="font-family: monospace;">
                            <small style="display: block; margin-top: 5px; color: #6c757d;">💡 לחץ על "איך להתחיל?" למדריך יצירת Token</small>
                        </div>
                    </div>

                    <div style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;">
                        <button id="saveDropboxTokenBtn" class="btn btn-primary">💾 שמור Token</button>
                        <button id="testDropboxConnectionBtn" class="btn btn-secondary">🔌 בדוק חיבור</button>
                    </div>

                    <div style="border-top: 1px solid #dee2e6; padding-top: 15px; margin-top: 15px;">
                        <label class="checkbox-container" style="margin-bottom: 15px;">
                            <input type="checkbox" id="dropboxAutoSync">
                            <span class="checkmark"></span>
                            <span class="checkbox-label">🔄 סנכרן אוטומטית בכל שמירה</span>
                        </label>

                        <label class="checkbox-container" style="margin-bottom: 15px;">
                            <input type="checkbox" id="dropboxBiDirectionalSync">
                            <span class="checkmark"></span>
                            <span class="checkbox-label">🔁 סנכרון דו-כיווני (בדיקה אוטומטית כל 2 דקות)</span>
                        </label>

                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button id="uploadToDropboxBtn" class="btn btn-success">📤 העלה נתונים ל-Dropbox</button>
                            <button id="downloadFromDropboxBtn" class="btn btn-warning">📥 הורד נתונים מ-Dropbox</button>
                        </div>
                    </div>
                </div>

                <!-- Mapping Section -->
                <div class="settings-section">
                    <div class="panel-header">
                        <h3 style="color: #1f4e79;">🗺️ מיפוי קטגוריות</h3>
                        <button id="addMappingBtn" class="btn btn-primary">+ הוסף מיפוי</button>
                    </div>

                <!-- Add Mapping Form -->
                <div id="mappingForm" class="form-card" style="display: none;">
                    <h3>מיפוי חדש</h3>
                    <form id="newMappingForm">
                        <div class="form-grid">
                            <div class="form-group">
                                <label for="mappingItem">פריט</label>
                                <input type="text" id="mappingItem" placeholder="למשל: סופרסל" required>
                            </div>
                            <div class="form-group">
                                <label for="mappingCategory">קטגוריה</label>
                                <select id="mappingCategory" required>
                                    <option value="">בחר קטגוריה</option>
                                    <option value="ביגוד">ביגוד</option>
                                    <option value="הוצאת ריכוז חודשית">הוצאת ריכוז חודשית</option>
                                    <option value="הפקדה לחסכון בבנק">הפקדה לחסכון בבנק</option>
                                    <option value="חינוך ותרבות">חינוך ותרבות</option>
                                    <option value="טיפול רפואי">טיפול רפואי</option>
                                    <option value="כלכלה">כלכלה</option>
                                    <option value="מיסים">מיסים</option>
                                    <option value="משכורת">משכורת</option>
                                    <option value="נסיעות">נסיעות</option>
                                    <option value="עמלת בנק">עמלת בנק</option>
                                    <option value="שונות">שונות</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="checkbox-container">
                                    <input type="checkbox" id="includeInMonthlyExpenses" checked>
                                    <span class="checkmark"></span>
                                    <span class="checkbox-label">כלול בטבלת "הוצאות החודש"</span>
                                </label>
                                <small style="color: #666; margin-top: 5px; display: block;">
                                    פריטים מסומנים יופיעו בטבלת "הוצאות החודש" בתצוגה חודשית (ללא תשלומי צ'יקים)
                                </small>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">💾 שמור</button>
                            <button type="button" id="cancelMapping" class="btn btn-secondary">❌ בטל</button>
                        </div>
                    </form>
                </div>

                <!-- Mapping Table -->
                <div class="table-container">
                    <table id="mappingTable" class="data-table">
                        <thead>
                            <tr>
                                <th>פריט</th>
                                <th>קטגוריה</th>
                                <th>שימוש</th>
                                <th>הוצאות חודשיות</th>
                                <th>פעולות</th>
                            </tr>
                        </thead>
                        <tbody id="mappingBody">
                            <!-- Mappings will be populated here -->
                        </tbody>
                    </table>
                </div>
                </div>
            </div>

            <!-- Monthly Tab -->
            <div id="monthly" class="tab-panel">
                <div class="panel-header">
                    <h2>📅 תצוגה חודשית</h2>
                    <div class="monthly-controls">
                        <div class="month-selector">
                            <label for="monthSelect">חודש:</label>
                            <select id="monthSelect">
                                <option value="01">ינואר</option>
                                <option value="02">פברואר</option>
                                <option value="03">מרץ</option>
                                <option value="04">אפריל</option>
                                <option value="05">מאי</option>
                                <option value="06">יוני</option>
                                <option value="07">יולי</option>
                                <option value="08">אוגוסט</option>
                                <option value="09">ספטמבר</option>
                                <option value="10">אוקטובר</option>
                                <option value="11">נובמבר</option>
                                <option value="12">דצמבר</option>
                            </select>
                        </div>
                        <button id="exportMonthlyReportBtn" class="btn btn-primary" title="פתח דוח חודשי מפורט בחלון חדש להדפסה (Ctrl+P להדפסה, Esc לסגירה)">📄 הצג דוח להדפסה</button>
                    </div>
                </div>

                <div class="monthly-content">
                    <!-- Monthly Balance Summary -->
                    <div class="summary-card balance-summary">
                        <h3>💳 סיכום יתרות ותזרים חודשי</h3>
                        <div id="balanceSummary" class="balance-table">
                            <!-- Balance summary will be populated here -->
                        </div>
                    </div>

                    <!-- Category Summary -->
                    <div class="summary-card">
                        <h3>📊 סיכום לפי קטגוריות</h3>
                        <div id="categorySummary" class="category-summary">
                            <!-- Category summary will be populated here -->
                        </div>
                    </div>

                    <!-- Actual Expenses (based on mapping property) -->
                    <div class="summary-card">
                        <h3 id="actualExpensesTitle">💰 הוצאות החודש</h3>
                        <p class="expenses-subtitle">פריטים המסומנים ב-"כלול בטבלת הוצאות החודש" (ללא תשלומי צ'יקים)</p>
                        <div id="actualExpensesSummary" class="actual-expenses-summary">
                            <!-- Actual expenses will be populated here -->
                        </div>
                    </div>

                    <!-- Monthly Transactions -->
                    <div class="summary-card">
                        <h3>📝 תנועות החודש</h3>
                        <div id="monthlyTransactions" class="monthly-transactions">
                            <!-- Monthly transactions will be populated here -->
                        </div>
                    </div>

                    <!-- Check Payments Summary -->
                    <div id="checkPaymentsSummary" class="summary-card" style="display: none;">
                        <h3>🏦 תשלומי צ'יקים בחודש</h3>
                        <div id="checkPaymentsList" class="check-payments-list">
                            <!-- Check payments will be populated here -->
                        </div>
                    </div>

                    <!-- Imported Check Items Summary (Monthly) -->
                    <div id="importedCheckItemsMonthly" class="summary-card" style="display: none;">
                        <h3>🏦 פרטי צ׳יק הוצאות חודש</h3>
                        <div id="importedCheckItemsMonthlyList" class="check-payments-list">
                            <!-- Imported check items will be populated here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard Tab -->
            <div id="dashboard" class="tab-panel">
                <div class="panel-header">
                    <h2>📈 סיכום כללי</h2>
                    <div class="dashboard-controls">
                        <div class="month-selector">
                            <label for="dashboardMonth">חודש נבחר:</label>
                            <select id="dashboardMonth">
                                <option value="01">ינואר</option>
                                <option value="02">פברואר</option>
                                <option value="03">מרץ</option>
                                <option value="04">אפריל</option>
                                <option value="05">מאי</option>
                                <option value="06">יוני</option>
                                <option value="07">יולי</option>
                                <option value="08">אוגוסט</option>
                                <option value="09">ספטמבר</option>
                                <option value="10">אוקטובר</option>
                                <option value="11">נובמבר</option>
                                <option value="12">דצמבר</option>
                            </select>
                        </div>
                        <button id="exportDashboardReportBtn" class="btn btn-primary" title="פתח דוח סיכום כללי בחלון חדש להדפסה (Ctrl+P להדפסה, Esc לסגירה)">📄 הצג דוח סיכום להדפסה</button>
                    </div>
                </div>

                <div class="dashboard-grid">
                    <!-- Monthly KPIs -->
                    <div class="kpi-card">
                        <h3>📊 סיכום חודשי</h3>
                        <div class="kpi-grid">
                            <div class="kpi-item expenses">
                                <span class="kpi-label">הוצאות:</span>
                                <span id="monthlyExpenses" class="kpi-value">₪0.00</span>
                            </div>
                            <div class="kpi-item income">
                                <span class="kpi-label">הכנסות:</span>
                                <span id="monthlyIncome" class="kpi-value">₪0.00</span>
                            </div>
                            <div class="kpi-item net">
                                <span class="kpi-label">נטו:</span>
                                <span id="monthlyNet" class="kpi-value">₪0.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Annual KPIs -->
                    <div class="kpi-card">
                        <h3>📈 סיכום שנתי</h3>
                        <div class="kpi-grid">
                            <div class="kpi-item expenses">
                                <span class="kpi-label">הוצאות:</span>
                                <span id="annualExpenses" class="kpi-value">₪0.00</span>
                            </div>
                            <div class="kpi-item income">
                                <span class="kpi-label">הכנסות:</span>
                                <span id="annualIncome" class="kpi-value">₪0.00</span>
                            </div>
                            <div class="kpi-item net">
                                <span class="kpi-label">נטו:</span>
                                <span id="annualNet" class="kpi-value">₪0.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Category Breakdown -->
                    <div class="chart-card">
                        <h3>💰 פילוח קטגוריות</h3>
                        <div id="categoryBreakdown" class="category-breakdown">
                            <!-- Category breakdown will be populated here -->
                        </div>
                    </div>

                    <!-- Monthly Trend -->
                    <div class="chart-card">
                        <h3>📊 מגמה חודשית</h3>
                        <div id="monthlyTrend" class="monthly-trend">
                            <!-- Monthly trend chart will be populated here -->
                        </div>
                    </div>
                </div>

                <!-- Annual Summary Table -->
                <div class="annual-summary-section">
                    <div class="summary-card full-width">
                        <h3>📋 טבלת סיכום שנתי - פילוח קטגוריות חודשי</h3>
                        <div class="table-container">
                            <div id="annualSummaryTable" class="annual-summary-table">
                                <!-- Annual summary table will be populated here -->
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Scripts -->
    <script src="budget.js"></script>
    <script src="dropbox-sync.js"></script>
</body>
</html>
