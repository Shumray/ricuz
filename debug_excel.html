<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ” ×‘×“×™×§×ª ×§×•×‘×¥ Excel - ××¨×¥ 2025</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js" integrity="sha512-r22gChDnGvBylk90+2e/ycr+equG0CPaoP7F09mZR9dPNZlV43Q3Iw7YSn8WP9rbI9eqlXmwY6y0Sl5L+IZVcA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            direction: rtl;
            padding: 20px;
            max-width: 1200px;
            margin: 0 auto;
            background: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1f4e79;
            text-align: center;
            margin-bottom: 30px;
        }
        .upload-area {
            border: 3px dashed #1f4e79;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin-bottom: 30px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .upload-area:hover {
            background: #f0f7ff;
            border-color: #0066cc;
        }
        .upload-area input {
            display: none;
        }
        .btn {
            background: #1f4e79;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            font-family: inherit;
        }
        .btn:hover {
            background: #0066cc;
        }
        .info-box {
            background: #e7f3ff;
            border: 2px solid #1f4e79;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }
        .info-box h3 {
            margin-top: 0;
            color: #1f4e79;
        }
        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            font-size: 14px;
        }
        .data-table th, .data-table td {
            border: 1px solid #ddd;
            padding: 10px;
            text-align: right;
        }
        .data-table th {
            background: #1f4e79;
            color: white;
            font-weight: 600;
        }
        .data-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        .error {
            background: #ffe7e7;
            border: 2px solid #dc3545;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .success {
            background: #d4edda;
            border: 2px solid #28a745;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        pre {
            background: #f4f4f4;
            border: 1px solid #ddd;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            direction: ltr;
            text-align: left;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ×‘×“×™×§×ª ×§×•×‘×¥ Excel - march_s_2025.xlsx</h1>

        <div class="upload-area" onclick="document.getElementById('fileInput').click()">
            <input type="file" id="fileInput" accept=".xlsx,.xls">
            <div style="font-size: 48px; margin-bottom: 20px;">ğŸ“„</div>
            <h2>×œ×—×¥ ×›××Ÿ ×œ×‘×—×™×¨×ª ×§×•×‘×¥</h2>
            <p>×‘×—×¨ ××ª ×”×§×•×‘×¥: march_s_2025.xlsx</p>
        </div>

        <div id="results"></div>
    </div>

    <script>
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div class="info-box"><h3>â³ ×˜×•×¢×Ÿ ××ª ×”×§×•×‘×¥...</h3></div>';

            const reader = new FileReader();

            reader.onload = function(event) {
                try {
                    const data = new Uint8Array(event.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });

                    let html = '<div class="success"><h3>âœ… ×”×§×•×‘×¥ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”!</h3></div>';

                    // File info
                    html += '<div class="info-box">';
                    html += '<h3>ğŸ“Š ××™×“×¢ ×¢×œ ×”×§×•×‘×¥:</h3>';
                    html += `<p><strong>×©× ×”×§×•×‘×¥:</strong> ${file.name}</p>`;
                    html += `<p><strong>×’×•×“×œ:</strong> ${(file.size / 1024).toFixed(2)} KB</p>`;
                    html += `<p><strong>××¡×¤×¨ ×’×™×œ×™×•× ×•×ª:</strong> ${workbook.SheetNames.length}</p>`;
                    html += `<p><strong>×©××•×ª ×’×™×œ×™×•× ×•×ª:</strong> ${workbook.SheetNames.join(', ')}</p>`;
                    html += '</div>';

                    // First sheet analysis
                    const firstSheetName = workbook.SheetNames[0];
                    const worksheet = workbook.Sheets[firstSheetName];
                    const rawData = XLSX.utils.sheet_to_json(worksheet, { header: 1, defval: '' });

                    html += '<div class="info-box">';
                    html += `<h3>ğŸ“‹ × ×™×ª×•×— ×’×™×œ×™×•×Ÿ: ${firstSheetName}</h3>`;
                    html += `<p><strong>××¡×¤×¨ ×©×•×¨×•×ª:</strong> ${rawData.length}</p>`;
                    html += '</div>';

                    // Show first 15 rows
                    html += '<div class="info-box">';
                    html += '<h3>ğŸ” 15 ×”×©×•×¨×•×ª ×”×¨××©×•× ×•×ª:</h3>';
                    html += '<table class="data-table"><thead><tr><th>#</th><th>×ª×•×›×Ÿ ×”×©×•×¨×”</th></tr></thead><tbody>';

                    for (let i = 0; i < Math.min(15, rawData.length); i++) {
                        const row = rawData[i];
                        const rowStr = row.map(cell => {
                            if (cell === null || cell === undefined || cell === '') return '[×¨×™×§]';
                            return String(cell);
                        }).join(' | ');
                        html += `<tr><td>${i}</td><td style="direction: rtl;">${rowStr}</td></tr>`;
                    }

                    html += '</tbody></table></div>';

                    // Look for header row
                    html += '<div class="info-box">';
                    html += '<h3>ğŸ” ×—×™×¤×•×© ×©×•×¨×ª ×›×•×ª×¨×•×ª:</h3>';

                    let headerRowIndex = -1;
                    for (let i = 0; i < rawData.length; i++) {
                        const row = rawData[i];
                        const rowStr = row.join('|');
                        if (rowStr.includes('×ª××¨×™×š') && rowStr.includes('×”×¤×¢×•×œ×”')) {
                            headerRowIndex = i;
                            break;
                        }
                    }

                    if (headerRowIndex !== -1) {
                        html += `<p style="color: green; font-weight: bold;">âœ… ×©×•×¨×ª ×›×•×ª×¨×•×ª × ××¦××” ×‘×©×•×¨×” ${headerRowIndex}</p>`;
                        html += `<p><strong>×›×•×ª×¨×•×ª:</strong> ${rawData[headerRowIndex].join(', ')}</p>`;

                        // Column mapping
                        const headers = rawData[headerRowIndex];
                        const colMap = {};
                        headers.forEach((header, idx) => {
                            const h = String(header).trim();
                            colMap[h] = idx;
                        });

                        html += '<p><strong>××™×¤×•×™ ×¢××•×“×•×ª:</strong></p><pre>' + JSON.stringify(colMap, null, 2) + '</pre>';

                        // Check required columns
                        const dateCol = colMap['×ª××¨×™×š'];
                        const actionCol = colMap['×”×¤×¢×•×œ×”'];
                        const debitCol = colMap['×—×•×‘×”'] !== undefined ? colMap['×—×•×‘×”'] : colMap['×—×™×•×‘'];
                        const creditCol = colMap['×–×›×•×ª'];

                        html += '<p><strong>×¢××•×“×•×ª × ×“×¨×©×•×ª:</strong></p>';
                        html += `<ul>`;
                        html += `<li>×ª××¨×™×š: ${dateCol !== undefined ? 'âœ… × ××¦× (×¢××•×“×” ' + dateCol + ')' : 'âŒ ×œ× × ××¦×'}</li>`;
                        html += `<li>×”×¤×¢×•×œ×”: ${actionCol !== undefined ? 'âœ… × ××¦× (×¢××•×“×” ' + actionCol + ')' : 'âŒ ×œ× × ××¦×'}</li>`;
                        html += `<li>×—×•×‘×”/×—×™×•×‘: ${debitCol !== undefined ? 'âœ… × ××¦× (×¢××•×“×” ' + debitCol + ')' : 'âŒ ×œ× × ××¦×'}</li>`;
                        html += `<li>×–×›×•×ª: ${creditCol !== undefined ? 'âœ… × ××¦× (×¢××•×“×” ' + creditCol + ')' : 'âŒ ×œ× × ××¦×'}</li>`;
                        html += '</ul>';

                        // Show sample data rows
                        if (dateCol !== undefined && actionCol !== undefined) {
                            html += '<h4>ğŸ“Š 3 ×©×•×¨×•×ª ×“×•×’××”:</h4>';
                            html += '<table class="data-table"><thead><tr><th>×ª××¨×™×š</th><th>×¤×¢×•×œ×”</th><th>×—×•×‘×”</th><th>×–×›×•×ª</th></tr></thead><tbody>';

                            const dataRows = rawData.slice(headerRowIndex + 1);
                            for (let i = 0; i < Math.min(3, dataRows.length); i++) {
                                const row = dataRows[i];
                                html += '<tr>';
                                html += `<td>${row[dateCol] || '[×¨×™×§]'}</td>`;
                                html += `<td>${row[actionCol] || '[×¨×™×§]'}</td>`;
                                html += `<td>${debitCol !== undefined ? (row[debitCol] || '[×¨×™×§]') : 'N/A'}</td>`;
                                html += `<td>${creditCol !== undefined ? (row[creditCol] || '[×¨×™×§]') : 'N/A'}</td>`;
                                html += '</tr>';
                            }

                            html += '</tbody></table>';
                        }

                    } else {
                        html += '<p style="color: red; font-weight: bold;">âŒ ×©×•×¨×ª ×›×•×ª×¨×•×ª ×œ× × ××¦××”!</p>';
                        html += '<p>×—×™×¤×©× ×• ×©×•×¨×” ×©××›×™×œ×” ×’× "×ª××¨×™×š" ×•×’× "×”×¤×¢×•×œ×”" ××‘×œ ×œ× ××¦×× ×•.</p>';
                        html += '<p><strong>××•×œ×™ ×”×¢××•×“×•×ª × ×§×¨××•×ª ××—×¨×ª?</strong></p>';
                    }

                    html += '</div>';

                    resultsDiv.innerHTML = html;

                } catch (error) {
                    resultsDiv.innerHTML = `
                        <div class="error">
                            <h3>âŒ ×©×’×™××” ×‘×§×¨×™××ª ×”×§×•×‘×¥</h3>
                            <p><strong>×”×•×“×¢×ª ×©×’×™××”:</strong> ${error.message}</p>
                            <pre>${error.stack}</pre>
                        </div>
                    `;
                }
            };

            reader.onerror = function(error) {
                resultsDiv.innerHTML = `
                    <div class="error">
                        <h3>âŒ ×©×’×™××” ×‘×˜×¢×™× ×ª ×”×§×•×‘×¥</h3>
                        <p>×œ× × ×™×ª×Ÿ ×œ×§×¨×•× ××ª ×”×§×•×‘×¥ ××”×“×™×¡×§</p>
                    </div>
                `;
            };

            reader.readAsArrayBuffer(file);
        });
    </script>
</body>
</html>
