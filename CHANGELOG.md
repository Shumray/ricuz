# שינויים במערכת התקציב

## תאריך: 31 ינואר 2026

### תכונה חדשה: מערכת הוצאות חודשיות מבוססת Property 🎛️💰

#### מה השתנה?
כל מיפוי עכשיו כולל **property חדש**: `includeInMonthlyExpenses` שמאפשר שליטה מלאה על מה שמופיע בטבלת "הוצאות החודש".

#### מבנה חדש:
```json
{
  "mappings": {
    "רמי לוי": {
      "category": "כלכלה",
      "includeInMonthlyExpenses": true    ← חדש!
    }
  }
}
```

#### תכונות:
✅ **עמודה חדשה** בטבלת המיפויים: "הוצאות חודשיות" (✅/❌)  
✅ **Checkbox בטופס** מיפוי: "כלול בטבלת הוצאות החודש"  
✅ **שליטה מלאה** - כל פריט מוגדר בנפרד  
✅ **תאימות לאחור** - תומך בפורמט הישן והחדש  
✅ **עריכה קלה** - לחיצה אחת לשינוי

#### פריטים שלא נכללים (כברירת מחדל):
- משכורת, ביטוח לאומי, מענק עבודה
- הראל, מנורה, פניקס, מכבי
- עמלת בנק, ע מפעולות ישיר

#### איך להשתמש:
1. טאב "🗺️ מיפוי קטגוריות"
2. לחץ ✏️ ליד פריט
3. סמן/בטל ☑️ "כלול בטבלת הוצאות החודש"
4. שמור → הפריט יופיע/לא יופיע בטבלת "הוצאות החודש"

---

### תכונה: טבלת הוצאות בפועל 💰📊

#### מה נוסף?
נוספה טבלה חדשה בטאב **"📅 תצוגה חודשית"** שמציגה **"הוצאות החודש"** - רק הוצאות בפועל.

#### מה מוצג?
✅ **רק הוצאות** (לא הכנסות)  
✅ **ללא תשלומי צ'יקים** (רק מזומן/כרטיס)  
✅ **פילוח לפי קטגוריות** עם אחוזים  
✅ **סה"כ הוצאות בפועל**

#### דוגמה:
```
💰 הוצאות ינואר
הוצאות בפועל (ללא תשלומי צ'יקים וללא הכנסות)

┌──────────────────┬──────────────┬────────┐
│ קטגוריה         │ סכום         │ אחוז   │
├──────────────────┼──────────────┼────────┤
│ מזון             │ ₪1,250.00    │ 45.5%  │
│ נסיעות          │ ₪680.00      │ 24.7%  │
│ טיפול רפואי     │ ₪420.00      │ 15.3%  │
│ ביגוד            │ ₪280.00      │ 10.2%  │
│ שונות            │ ₪120.00      │ 4.3%   │
├──────────────────┼──────────────┼────────┤
│ סה"כ הוצאות בפועל: │ ₪2,750.00 │ 100%   │
└──────────────────┴──────────────┴────────┘
```

#### למה זה שימושי?
- 💳 **הבנת הוצאות ממשיות** - כמה באמת יצא מהכיס
- 📊 **פילוח ברור** - איפה הכסף הלך (עם אחוזים)
- 🎯 **ניהול תקציב** - השוואה לתקציב החודשי
- 🚫 **ללא רעשי רקע** - רק מה שבאמת שילמת (לא צ'יקים עתידיים)

#### הבדל מטבלאות אחרות:
- **"סיכום לפי קטגוריות"** - כולל הכל (הכנסות + הוצאות + צ'יקים)
- **"הוצאות החודש"** 🆕 - רק הוצאות בפועל (ללא צ'יקים וללא הכנסות)
- **"תנועות החודש"** - רשימה מפורטת של כל התנועות
- **"תשלומי צ'יקים"** - רק צ'יקים

#### טכני:
```javascript
updateActualExpensesSummary(month) {
    // סינון: רק הוצאות
    const actualExpenses = monthlyTransactions.filter(t => {
        if (t.type === 'income' || t.amount > 0) return false;  // לא הכנסות
        if (t.paymentMethod === 'check') return false;           // לא צ'יקים
        return true;
    });
    
    // קיבוץ לפי קטגוריה + חישוב אחוזים
    // טבלה HTML מעוצבת
}
```

---

### תכונה: הגנת מחיקה ואינדיקטור שימוש במיפויים 🛡️📊

#### מה השתנה?
נוספו שתי תכונות חשובות לטאב "🗺️ מיפוי קטגוריות":

1. **🛡️ הגנה מפני מחיקה** - לא ניתן למחוק מיפוי שעסקאות משתמשות בו
2. **📊 אינדיקטור שימוש** - עמודה חדשה "שימוש" המראה כמה עסקאות משתמשות בכל מיפוי

#### איך זה עובד?

##### אינדיקטור שימוש:
```
טבלת מיפויים:
┌──────────────┬──────────────┬──────────┬────────────┐
│ פריט         │ קטגוריה     │ שימוש    │ פעולות     │
├──────────────┼──────────────┼──────────┼────────────┤
│ רמי לוי      │ מזון         │ 📊 12    │ ✏️  🗑️    │ ← 12 עסקאות
│ סופרסל       │ מזון         │ 📊 8     │ ✏️  🗑️    │ ← 8 עסקאות
│ תספורת       │ ביגוד        │ ⚪ 0     │ ✏️  🗑️    │ ← ללא שימוש
└──────────────┴──────────────┴──────────┴────────────┘
```

##### הגנת מחיקה:
```
ניסית למחוק "רמי לוי" (12 עסקאות):
┌──────────────────────────────────────┐
│ ❌ לא ניתן למחוק את המיפוי "רמי לוי" │
│ הפריט בשימוש ב-12 עסקאות.           │
│ מחק תחילה את כל העסקאות              │
│ המשתמשות בפריט זה.                  │
└──────────────────────────────────────┘

ניסית למחוק "תספורת" (0 עסקאות):
✅ המחיקה מותרת - אין עסקאות תלויות
```

#### יתרונות:
- ✅ הגנה מפני מחיקה בטעות של מיפויים בשימוש
- ✅ שקיפות - יודע בדיוק כמה עסקאות משתמשות בכל פריט
- ✅ זיהוי מיפויים מיותרים (⚪ 0) - בטוח למחוק
- ✅ הבנת דפוסי שימוש - איזה פריטים משמשים הכי הרבה
- ✅ ניקוי קל וביטחוני של מיפויים ישנים

#### טכני:
```javascript
// ספירת שימוש
countTransactionsUsingItem(item) {
    return this.transactions.filter(t => t.item === item).length;
}

// חסימת מחיקה אם יש שימוש
deleteMapping(item) {
    const usageCount = this.countTransactionsUsingItem(item);
    if (usageCount > 0) {
        alert(`❌ לא ניתן למחוק - בשימוש ב-${usageCount} עסקאות`);
        return;  // חסימה!
    }
    // המשך למחיקה רגילה...
}
```

---

### תכונה: מיון אלפביתי בטבלת העסקאות 🔤

#### מה השתנה?
טבלת "📊 הזנת עסקאות" כעת ממוינת **אלפבתית לפי שם הפריט** (א-ב).

#### לפני:
העסקאות היו ממוינות לפי:
1. חודש (מהאחרון לראשון)
2. תאריך הוספה (מהחדש לישן)

#### אחרי:
העסקאות ממוינות **אלפבתית לפי שם הפריט** (א-ב):
- אושר עד
- ביגוד
- ביטוח לאומי
- גט
- מגא
- משכורת
- רמי לוי
- סופרסל

#### יתרונות:
- ✅ קל למצוא פריטים ספציפיים
- ✅ סדר עקבי וצפוי
- ✅ נוח לסריקה ויזואלית
- ✅ תואם למיון בעברית

#### טכני:
```javascript
// מיון אלפביתי בעברית
const sortedTransactions = [...currentYearTransactions].sort((a, b) => {
    return a.item.localeCompare(b.item, 'he');
});
```

---

### תכונה: עריכת מיפויים קיימים ✏️

#### מה השתנה?
נוספה אפשרות **לערוך** מיפויים קיימים בטאב "🗺️ מיפוי קטגוריות", לא רק למחוק ולהוסיף חדשים.

#### איך זה עובד?
1. **עבור לטאב "מיפוי קטגוריות"**
2. **לחץ על כפתור העריכה (✏️)** ליד המיפוי שרוצים לערוך
3. **הטופס נפתח** עם הפרטים הקיימים:
   - **פריט**: מוצג אך לא ניתן לשינוי (readonly)
   - **קטגוריה**: ניתן לשינוי - בחר קטגוריה חדשה
4. **לחץ "💾 עדכן"** → המיפוי מתעדכן!

#### יתרונות:
- ✅ לא צריך למחוק ולהוסיף מיפוי חדש
- ✅ תהליך מהיר ונוח יותר
- ✅ שומר על עקביות - שם הפריט לא משתנה
- ✅ עדכון אוטומטי של כל העסקאות בטבלה

#### דוגמה:
```
לפני: "סופרסל" → "כלכלה"
עריכה: לחץ ✏️ → שנה ל"מזון"
אחרי: "סופרסל" → "מזון" ✓
```

---

### תכונה: בחירת חודש במקום אחד בלבד

#### מה השתנה?
הוסר שדה בחירת החודש מטופס "עסקה חדשה". כעת בחירת החודש נעשית רק במקום אחד - בבורר החודש בראש הטאב "הזנת עסקאות".

**בונוס**: החודש שבוחרים נשמר ב-localStorage ונשאר כברירת מחדל גם אחרי סגירת האתר! 💾

#### איך זה עובד?
1. **בחר חודש** בבורר שבראש הטאב (למשל: פברואר)
2. **לחץ "הוסף עסקה"** → הטופס נפתח ללא שדה חודש
3. **מלא פרטים ושמור** → העסקה נוספת לחודש שנבחר בבורר העליון
4. **עריכת עסקה** → כשעורכים עסקה קיימת, היא נשארת באותו חודש מקורי
5. **זכירה** → סגור את האתר ופתח שוב → החודש שבחרת יישאר נבחר! ✨

#### יתרונות:
- ✅ פשטות - בחירת חודש במקום אחד בלבד
- ✅ עקביות - כל העסקאות שמוסיפים הולכות לאותו חודש
- ✅ טופס מקוצר וברור יותר
- ✅ מניעת טעויות - אי אפשר לשכוח לבחור חודש בטופס
- ✅ זכירה - החודש נשמר גם אחרי סגירת האתר 💾

#### הגנה מפני טעויות:
- 🚫 אי אפשר להוסיף עסקה כשבחרת "כל החודשים" - המערכת תבקש לבחור חודש ספציפי

---

### תכונה: סינון לפי חודש בטבלת הזנת עסקאות

#### מה השתנה?
נוסף בורר חודש בטאב "📊 הזנת עסקאות" המאפשר לסנן את הטבלה ולראות רק עסקאות של חודש מסוים:
- ✅ בחירה בין "כל החודשים" או חודש ספציפי
- ✅ הטבלה מתעדכנת אוטומטית בעת שינוי החודש
- ✅ ברירת המחדל היא החודש הנוכחי
- ✅ עיצוב מתאים ונוח לשימוש

#### איך זה עובד?
1. **בכניסה לטאב**: הטבלה מציגה את העסקאות של החודש הנוכחי (ינואר 2026)
2. **בחירת חודש**: לחץ על בורר החודש ובחר חודש אחר
3. **סינון אוטומטי**: הטבלה תציג רק עסקאות של החודש שנבחר
4. **כל החודשים**: בחר באופציה "כל החודשים" כדי לראות את כל העסקאות של השנה

---
**גרסה**: 1.5.0
**מפתח**: GitHub Copilot
