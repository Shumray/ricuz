# שינויים במערכת התקציב

## תאריך: 8 פברואר 2026

### תכונה חדשה: הוספה ידנית של פריטי שיק מיוחדים (שיק) 💜✨

#### מה חדש?
כעת ניתן להוסיף פריטי **(שיק)** מיוחדים **באופן ידני** ישירות מטופס "עסקה חדשה", בלי צורך לייבא קובץ CSV/Excel!

#### איך זה עובד?
1. **לחץ על "➕ הוסף עסקה"** בטאב "הזנת נתונים"
2. **מלא את הפרטים**:
   - פריט: תיאור כלשהו (לדוגמה: "הוצאות שונות")
   - סכום: הסכום הרצוי
   - הערה: (אופציונלי)
3. **סמן את הcheckbox "💜 פריט שיק מיוחד (שיק)"**
4. **לחץ "💾 שמור"**

#### תכונות:
✅ **הוספה ידנית** - לא צריך לייבא קובץ כדי ליצור פריט (שיק)  
✅ **ממשק פשוט** - checkbox נוסף בטופס העסקה  
✅ **סרגול אוטומטי** - אם בוחרים "פריט שיק מיוחד", "תשלום בצ'יק" מתבטל (והפוך)  
✅ **עיצוב ייחודי** - הפריט מופיע עם רקע סגול בהיר 💜  
✅ **לא נכלל בחישובים** - הפריט לא משפיע על סיכומי הכנסה/הוצאה  
✅ **ניתן לעריכה** - לאחר היצירה ניתן לערוך את כל הפרטים (מספר צ'יק, מוטב, וכו')

#### הבדל מ"תשלום בצ'יק" רגיל:
| תכונה | תשלום בצ'יק | פריט שיק מיוחד (שיק) |
|-------|-------------|---------------------|
| רקע | 🟡 צהוב | 💜 סגול בהיר |
| נכלל בטבלת עסקאות | ✅ כן | ❌ לא |
| נכלל בחישובי הכנסה/הוצאה | ✅ כן | ❌ לא |
| מוצג ב | טבלת עסקאות + סעיף צ'יקים | רק בסעיף פריטי שיק |

#### דוגמה:
```
1. פתח "➕ הוסף עסקה"
2. מלא:
   - פריט: "הוצאות דואר"
   - סכום: 250
   - סמן: ✅ פריט שיק מיוחד (שיק)
3. לחץ "💾 שמור"

תוצאה:
🏦 פרטי צ׳יק הוצאות חודש פברואר
┌──────────────────────────────────────┐
│ 💜 רקע סגול בהיר                    │
│ צ'יק מספר: (לא הוזן)                │
│ מוטב: (לא הוזן)                     │
│ עבור: הוצאות דואר                   │
│ סכום: ₪250.00-                      │
│ [✏️ ערוך] [🗑️ מחק]                 │
└──────────────────────────────────────┘
```

#### יתרונות:
- 🚀 **מהיר** - אין צורך לייבא קובץ
- 💡 **גמיש** - ניתן להוסיף פריטי (שיק) בכל עת
- 🎯 **מדויק** - שליטה מלאה על כל פריט
- 📝 **ניתן לעריכה** - אפשר לערוך את כל הפרטים אחר כך

---

### תכונה חדשה: טיפול בפריטי שיק מיובאים 🏦✅

#### מה השתנה?
בעת ייבוא דף חשבון (Excel או CSV), המערכת מזהה פריטים מיוחדים בשם "(שיק)" ומטפלת בהם בצורה ייחודית:

#### תכונות:
✅ **זיהוי אוטומטי** - פריטים בשם "(שיק)" לא נכנסים לטבלת העסקאות הראשית  
✅ **אזור ייעודי** - מוצגים בטבלה נפרדת מתחת לעסקאות  
✅ **עיצוב ייחודי** - רקע סגול בהיר (#f3e5f5) **רק לפריטים "(שיק)"** (בתוך סוגריים)  
    - פריטי "שיק" רגילים (בלי סוגריים) נשארים עם רקע צהוב (#fff8e1)
✅ **פרטים מלאים**:
  - צ'יק מספר (ניתן לעריכה)
  - מוטב (ניתן לעריכה)
  - עבור: ברירת מחדל "הוצאות חודש <שם החודש>" (ניתן לעריכה)
  - הערה (אופציונלי)
✅ **עריכה מלאה** - ניתן לערוך את כל הפרטים ולשמור  
✅ **אינטגרציה בתצוגה חודשית** - הפריטים מופיעים גם בטאב "תצוגה חודשית"  
✅ **מוגן מעריכה** - בתצוגה החודשית אין אפשרות עריכה/מחיקה (קריאה בלבד)

#### איך זה עובד?
1. **ייבוא** קובץ Excel/CSV עם פריטים בשם "(שיק)"
2. **זיהוי אוטומטי** - הפריטים לא נספרים בחישובי הכנסה/הוצאה
3. **תצוגה בטאב הזנת נתונים**:
   - מוצגים בכרטיס "פרטי צ'יק הוצאות חודש <שם החודש>"
   - ניתן לערוך כל פרט (✏️) או למחוק (🗑️)
4. **תצוגה בתצוגה חודשית**:
   - מוצגים באותו כרטיס בתצוגה חודשית
   - **קריאה בלבד** - ללא כפתורי עריכה/מחיקה

#### דוגמה:
```
ייבוא קובץ עם שורה:
תאריך: 01/02/2026
תיאור: (שיק)
סכום: -500

תוצאה:
🏦 פרטי צ׳יק הוצאות חודש פברואר
┌──────────────────────────────────────┐
│ 💜 רקע סגול בהיר - פריט יוצא דופן   │
│ צ'יק מספר: (לא הוזן)                │
│ מוטב: (לא הוזן)                     │
│ עבור: הוצאות חודש פברואר            │
│ סכום: ₪500.00-                      │
│ [✏️ ערוך] [🗑️ מחק]                 │ ← רק בטאב הזנת נתונים
└──────────────────────────────────────┘

בתצוגה חודשית:
🏦 פרטי צ׳יק הוצאות חודש פברואר
┌──────────────────────────────────────┐
│ 💜 רקע סגול בהיר - פריט יוצא דופן   │
│ צ'יק מספר: (לא הוזן)                │
│ מוטב: (לא הוזן)                     │
│ עבור: הוצאות חודש פברואר            │
│ סכום: ₪500.00-                      │
└──────────────────────────────────────┘ ← קריאה בלבד
```

#### יתרונות:
- 🎯 **ניהול נפרד** - פריטי "(שיק)" לא מתערבבים עם עסקאות רגילות
- 💜 **זיהוי ויזואלי** - רקע סגול בהיר **רק לפריטים "(שיק)"** מבדל אותם מפריטי "שיק" רגילים (צהוב)
- 📊 **חישובים נכונים** - לא משפיעים על סיכומי הכנסות/הוצאות
- ✏️ **גמישות** - ניתן לעדכן פרטים לאחר הייבוא
- 👀 **שקיפות** - מוצגים בכל התצוגות הרלוונטיות
- 🔒 **הגנה בתצוגה חודשית** - מונע שינויים בטעות

---

## תאריך: 31 ינואר 2026

### תכונה חדשה: מערכת הוצאות חודשיות מבוססת Property 🎛️💰

#### מה השתנה?
כל מיפוי עכשיו כולל **property חדש**: `includeInMonthlyExpenses` שמאפשר שליטה מלאה על מה שמופיע בטבלת "הוצאות החודש".

#### מבנה חדש:
```json
{
  "mappings": {
    "רמי לוי": {
      "category": "כלכלה",
      "includeInMonthlyExpenses": true    ← חדש!
    }
  }
}
```

#### תכונות:
✅ **עמודה חדשה** בטבלת המיפויים: "הוצאות חודשיות" (✅/❌)  
✅ **Checkbox בטופס** מיפוי: "כלול בטבלת הוצאות החודש"  
✅ **שליטה מלאה** - כל פריט מוגדר בנפרד  
✅ **תאימות לאחור** - תומך בפורמט הישן והחדש  
✅ **עריכה קלה** - לחיצה אחת לשינוי

#### פריטים שלא נכללים (כברירת מחדל):
- משכורת, ביטוח לאומי, מענק עבודה
- הראל, מנורה, פניקס, מכבי
- עמלת בנק, ע מפעולות ישיר

#### איך להשתמש:
1. טאב "🗺️ מיפוי קטגוריות"
2. לחץ ✏️ ליד פריט
3. סמן/בטל ☑️ "כלול בטבלת הוצאות החודש"
4. שמור → הפריט יופיע/לא יופיע בטבלת "הוצאות החודש"

---

### תכונה: טבלת הוצאות בפועל 💰📊

#### מה נוסף?
נוספה טבלה חדשה בטאב **"📅 תצוגה חודשית"** שמציגה **"הוצאות החודש"** - רק הוצאות בפועל.

#### מה מוצג?
✅ **רק הוצאות** (לא הכנסות)  
✅ **ללא תשלומי צ'יקים** (רק מזומן/כרטיס)  
✅ **פילוח לפי קטגוריות** עם אחוזים  
✅ **סה"כ הוצאות בפועל**

#### דוגמה:
```
💰 הוצאות ינואר
הוצאות בפועל (ללא תשלומי צ'יקים וללא הכנסות)

┌──────────────────┬──────────────┬────────┐
│ קטגוריה         │ סכום         │ אחוז   │
├──────────────────┼──────────────┼────────┤
│ מזון             │ ₪1,250.00    │ 45.5%  │
│ נסיעות          │ ₪680.00      │ 24.7%  │
│ טיפול רפואי     │ ₪420.00      │ 15.3%  │
│ ביגוד            │ ₪280.00      │ 10.2%  │
│ שונות            │ ₪120.00      │ 4.3%   │
├──────────────────┼──────────────┼────────┤
│ סה"כ הוצאות בפועל: │ ₪2,750.00 │ 100%   │
└──────────────────┴──────────────┴────────┘
```

#### למה זה שימושי?
- 💳 **הבנת הוצאות ממשיות** - כמה באמת יצא מהכיס
- 📊 **פילוח ברור** - איפה הכסף הלך (עם אחוזים)
- 🎯 **ניהול תקציב** - השוואה לתקציב החודשי
- 🚫 **ללא רעשי רקע** - רק מה שבאמת שילמת (לא צ'יקים עתידיים)

#### הבדל מטבלאות אחרות:
- **"סיכום לפי קטגוריות"** - כולל הכל (הכנסות + הוצאות + צ'יקים)
- **"הוצאות החודש"** 🆕 - רק הוצאות בפועל (ללא צ'יקים וללא הכנסות)
- **"תנועות החודש"** - רשימה מפורטת של כל התנועות
- **"תשלומי צ'יקים"** - רק צ'יקים

#### טכני:
```javascript
updateActualExpensesSummary(month) {
    // סינון: רק הוצאות
    const actualExpenses = monthlyTransactions.filter(t => {
        if (t.type === 'income' || t.amount > 0) return false;  // לא הכנסות
        if (t.paymentMethod === 'check') return false;           // לא צ'יקים
        return true;
    });
    
    // קיבוץ לפי קטגוריה + חישוב אחוזים
    // טבלה HTML מעוצבת
}
```

---

### תכונה: הגנת מחיקה ואינדיקטור שימוש במיפויים 🛡️📊

#### מה השתנה?
נוספו שתי תכונות חשובות לטאב "🗺️ מיפוי קטגוריות":

1. **🛡️ הגנה מפני מחיקה** - לא ניתן למחוק מיפוי שעסקאות משתמשות בו
2. **📊 אינדיקטור שימוש** - עמודה חדשה "שימוש" המראה כמה עסקאות משתמשות בכל מיפוי

#### איך זה עובד?

##### אינדיקטור שימוש:
```
טבלת מיפויים:
┌──────────────┬──────────────┬──────────┬────────────┐
│ פריט         │ קטגוריה     │ שימוש    │ פעולות     │
├──────────────┼──────────────┼──────────┼────────────┤
│ רמי לוי      │ מזון         │ 📊 12    │ ✏️  🗑️    │ ← 12 עסקאות
│ סופרסל       │ מזון         │ 📊 8     │ ✏️  🗑️    │ ← 8 עסקאות
│ תספורת       │ ביגוד        │ ⚪ 0     │ ✏️  🗑️    │ ← ללא שימוש
└──────────────┴──────────────┴──────────┴────────────┘
```

##### הגנת מחיקה:
```
ניסית למחוק "רמי לוי" (12 עסקאות):
┌──────────────────────────────────────┐
│ ❌ לא ניתן למחוק את המיפוי "רמי לוי" │
│ הפריט בשימוש ב-12 עסקאות.           │
│ מחק תחילה את כל העסקאות              │
│ המשתמשות בפריט זה.                  │
└──────────────────────────────────────┘

ניסית למחוק "תספורת" (0 עסקאות):
✅ המחיקה מותרת - אין עסקאות תלויות
```

#### יתרונות:
- ✅ הגנה מפני מחיקה בטעות של מיפויים בשימוש
- ✅ שקיפות - יודע בדיוק כמה עסקאות משתמשות בכל פריט
- ✅ זיהוי מיפויים מיותרים (⚪ 0) - בטוח למחוק
- ✅ הבנת דפוסי שימוש - איזה פריטים משמשים הכי הרבה
- ✅ ניקוי קל וביטחוני של מיפויים ישנים

#### טכני:
```javascript
// ספירת שימוש
countTransactionsUsingItem(item) {
    return this.transactions.filter(t => t.item === item).length;
}

// חסימת מחיקה אם יש שימוש
deleteMapping(item) {
    const usageCount = this.countTransactionsUsingItem(item);
    if (usageCount > 0) {
        alert(`❌ לא ניתן למחוק - בשימוש ב-${usageCount} עסקאות`);
        return;  // חסימה!
    }
    // המשך למחיקה רגילה...
}
```

---

### תכונה: מיון אלפביתי בטבלת העסקאות 🔤

#### מה השתנה?
טבלת "📊 הזנת עסקאות" כעת ממוינת **אלפבתית לפי שם הפריט** (א-ב).

#### לפני:
העסקאות היו ממוינות לפי:
1. חודש (מהאחרון לראשון)
2. תאריך הוספה (מהחדש לישן)

#### אחרי:
העסקאות ממוינות **אלפבתית לפי שם הפריט** (א-ב):
- אושר עד
- ביגוד
- ביטוח לאומי
- גט
- מגא
- משכורת
- רמי לוי
- סופרסל

#### יתרונות:
- ✅ קל למצוא פריטים ספציפיים
- ✅ סדר עקבי וצפוי
- ✅ נוח לסריקה ויזואלית
- ✅ תואם למיון בעברית

#### טכני:
```javascript
// מיון אלפביתי בעברית
const sortedTransactions = [...currentYearTransactions].sort((a, b) => {
    return a.item.localeCompare(b.item, 'he');
});
```

---

### תכונה: עריכת מיפויים קיימים ✏️

#### מה השתנה?
נוספה אפשרות **לערוך** מיפויים קיימים בטאב "🗺️ מיפוי קטגוריות", לא רק למחוק ולהוסיף חדשים.

#### איך זה עובד?
1. **עבור לטאב "מיפוי קטגוריות"**
2. **לחץ על כפתור העריכה (✏️)** ליד המיפוי שרוצים לערוך
3. **הטופס נפתח** עם הפרטים הקיימים:
   - **פריט**: מוצג אך לא ניתן לשינוי (readonly)
   - **קטגוריה**: ניתן לשינוי - בחר קטגוריה חדשה
4. **לחץ "💾 עדכן"** → המיפוי מתעדכן!

#### יתרונות:
- ✅ לא צריך למחוק ולהוסיף מיפוי חדש
- ✅ תהליך מהיר ונוח יותר
- ✅ שומר על עקביות - שם הפריט לא משתנה
- ✅ עדכון אוטומטי של כל העסקאות בטבלה

#### דוגמה:
```
לפני: "סופרסל" → "כלכלה"
עריכה: לחץ ✏️ → שנה ל"מזון"
אחרי: "סופרסל" → "מזון" ✓
```

---

### תכונה: בחירת חודש במקום אחד בלבד

#### מה השתנה?
הוסר שדה בחירת החודש מטופס "עסקה חדשה". כעת בחירת החודש נעשית רק במקום אחד - בבורר החודש בראש הטאב "הזנת עסקאות".

**בונוס**: החודש שבוחרים נשמר ב-localStorage ונשאר כברירת מחדל גם אחרי סגירת האתר! 💾

#### איך זה עובד?
1. **בחר חודש** בבורר שבראש הטאב (למשל: פברואר)
2. **לחץ "הוסף עסקה"** → הטופס נפתח ללא שדה חודש
3. **מלא פרטים ושמור** → העסקה נוספת לחודש שנבחר בבורר העליון
4. **עריכת עסקה** → כשעורכים עסקה קיימת, היא נשארת באותו חודש מקורי
5. **זכירה** → סגור את האתר ופתח שוב → החודש שבחרת יישאר נבחר! ✨

#### יתרונות:
- ✅ פשטות - בחירת חודש במקום אחד בלבד
- ✅ עקביות - כל העסקאות שמוסיפים הולכות לאותו חודש
- ✅ טופס מקוצר וברור יותר
- ✅ מניעת טעויות - אי אפשר לשכוח לבחור חודש בטופס
- ✅ זכירה - החודש נשמר גם אחרי סגירת האתר 💾

#### הגנה מפני טעויות:
- 🚫 אי אפשר להוסיף עסקה כשבחרת "כל החודשים" - המערכת תבקש לבחור חודש ספציפי

---

### תכונה: סינון לפי חודש בטבלת הזנת עסקאות

#### מה השתנה?
נוסף בורר חודש בטאב "📊 הזנת עסקאות" המאפשר לסנן את הטבלה ולראות רק עסקאות של חודש מסוים:
- ✅ בחירה בין "כל החודשים" או חודש ספציפי
- ✅ הטבלה מתעדכנת אוטומטית בעת שינוי החודש
- ✅ ברירת המחדל היא החודש הנוכחי
- ✅ עיצוב מתאים ונוח לשימוש

#### איך זה עובד?
1. **בכניסה לטאב**: הטבלה מציגה את העסקאות של החודש הנוכחי (ינואר 2026)
2. **בחירת חודש**: לחץ על בורר החודש ובחר חודש אחר
3. **סינון אוטומטי**: הטבלה תציג רק עסקאות של החודש שנבחר
4. **כל החודשים**: בחר באופציה "כל החודשים" כדי לראות את כל העסקאות של השנה

---
**גרסה**: 1.5.0
**מפתח**: GitHub Copilot
